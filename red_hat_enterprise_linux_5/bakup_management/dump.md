### dump {#dump}

dump

功能说明：备份文件系统。

语　　法：dump [-cnu][-0123456789][-b &lt;区块大小&gt;][-B &lt;区块数目&gt;][-d &lt;密度&gt;][-f &lt;设备名称&gt;][-h &lt;层级&gt;][-s &lt;磁带长度&gt;][-T &lt;日期&gt;][目录或文件系统] 或 dump [-wW]

补充说明：dump为备份工具程序，可将目录或整个文件系统备份至指定的设备，或备份成一个大文件。

参　　数：

　-0123456789 备份的层级。

　-b&lt;区块大小&gt; 指定区块的大小，单位为KB。

　-B&lt;区块数目&gt; 指定备份卷册的区块数目。

　-c 　       修改备份磁带预设的密度与容量。

　-f&lt;设备名称&gt; 指定备份设备。

　-n 　       当备份工作需要管理员介入时，向所有&quot;operator&quot;群组中的使用者发出通知。

　-d&lt;密度&gt; 　    设置磁带的密度。单位为BPI。

　-h&lt;层级&gt; 　    当备份层级等于或大雨指定的层级时，将不备份用户标示为&quot;nodump&quot;的文件。

　-s&lt;磁带长度&gt;   备份磁带的长度，单位为英尺。

　-T&lt;日期&gt; 　    指定开始备份的时间与日期。

　-u 　    备份完毕后，在/etc/dumpdates中记录备份的文件系统，层级，日期与时间等。

　-w 　    与-W类似，但仅显示需要备份的文件。

　-W 　    显示需要备份的文件及其最后一次备份的层级，时间与日期。

1.dump

dump可以执行类似 tar 的功能。然而， dump 倾向于考虑文件系统而不是个别的文件。下面是引自 dump 手册文件中的内容：&quot;dump 检查 ext2 文件系统上的文件，并确定哪些文件需要备份。这些文件将出于安全保护而被复制到给定的磁盘、磁带或其他存储媒体上……大于输出媒体容量的转储将被划分到多个卷。在大多数媒体上，容量是通过一直写入直至返回一个 end-of-media 标记来确定的。&quot;

dump 的一个有趣特性是其内置的增量备份功能。在上面的例子中， 0 表示 0 级或基本级备份。这是完全系统备份，您要定期执行以保存整个系统。对于后续的备份，您可以使用其他数字（1-9）来代替 0，以改变备份级别。1 级备份会保存自从执行 0 级备份以来更改过的所有文件。2 级备份会保存自从执行 1 级备份以来更改过的所有文件，以此类推。 dump 具有它自己的机制，即它在执行备份时会输出一个更新文件（/etc/dumpupdates）。这个更新文件将在每次执行 0 级备份时被重设。后续级别的备份会保留它们的标记，直至执行另一次 0 级备份。如果您在执行基于磁带的备份， dump 会自动跟踪多个卷。级别为N的转储会对从上次进行的级别小于N的转储操作以来修改过的所有文件进行备份，而级别0就是完全备份。通过这种方式，可以很轻松的实现增量备份，差异备份，甚至每日备份。例如，第一次备份时可选择级别0（具体操作看后面），以后每天做增量备份时就可以每天依次使用级别1，级别2，级别3等等… …；当需要每天做差异备份时，可先选择级别0做完整备份，然后每天都使用同一大于0的级别就行了，比如说第二天用5，第三天也用5，第四天也一样。

使用dump的优点：

1，备份可以跨多卷磁带

2，能备份任何类型的文件，甚至是设备

3，备份时，文件的权限，宿主，宿组，修改时间等都会被保存

4，能够正确处理从未包含任何数据的文件块（孔洞文件）

5，能够做增量，差异备份

使用dump的缺点：

1，每个文件系统必须单独转储备份

2，只有本地计算机的文件系统才能够转储备份（rdump，rrestore可用来弥补此项不足）

当然，使用tar也可以用来实现备份和还原，但tar只能在Linux或Unix环境下使用，对于跨平台的环境，dump使用起来个人感觉更方便一些。

如果有条件，dump也可以将备份存储在磁带上。Linux通常用/dev/st0代表倒带设备，而用/dev/nst0代表非倒带设备，使用倒带设备存储时，当磁带用完它会自动倒带并接着存储，所以会覆盖以前的数据，这样就存在以前数据丢失的风险。这个地方咱们就不详细讨论了。

e.g.:

-0 是备份的等级，从0－9，0以后都是更新备份的参数，一般常用的是0和9

-u 是将备份记录写入/etc/dumpdates这个文件中；当你备份的目录是一个子目录，而不是一个分区的顶层目录时-u参数是不能使用的

-f 是指定备份到那个文件,也可以指定一个设备文件，我在这里指定的就是一个分区

[root@node /]# dump -0uf /back/boot.dump /boot   #

[root@node /]# dump -0f /back/etc.dump /etc        #没有独立分区时，不适用 -u 选项

[root@node /]# dump -1f /back/etc.dump /etc        #没有独立分区时，不适用 -u 选项  

[root@node /]# dump 0f /dev/nst0 /boot

[root@node /]# dump 0f /dev/nst0 /

在这个例子中，系统中有两个文件系统。一个用于 /boot，另一个用于 / ，这是常见的配置。它们必须在执行备份时单独地引用。 /dev/nst0 引用第一个 SCSI 磁带驱动器，不过是以非重绕的模式引用。这样确保各个卷在磁带上一个接一个地排列。

跳过文件

标记将被 dump 跳过的文件和目录是可以做到的。实现此目的的命令是 chattr ，它改变 ext2 和 ext3 文件系统上的扩展属性。

[root@node ~]#  chattr +d &lt;filename&gt;

2.restore

使用 restore 来执行还原

restore 配合dump 的程序是，它用于从转储映像还原文件。

restore 命令执行转储的逆向功能。可以首先还原文件系统的完全备份，而后续的增量备份可以在已还原的完全备份之上覆盖。可以从完全或部分备份中还原单独的文件或者目录树。

要还原使用 dump 保存的信息，可以使用 restore 命令。像 tar 一样， dump 能够列出（ -t ）归档文件的内容，并与当前文件作比较（ -C ）。使用 dump 時必须小心的地方是还原数据。有两种非常不同的还原方法，您必须使用正确的方法才能获得可预测的结果。

重建 (-r)

记住，在设计 dump 时考虑得更多的是文件系统，而不是单独的文件。因此，存在两种不同的文件还原风格。要重建一个文件系统，可使用 -r 命令行开关。设计重建的目的是为了能在空文件系统上操作，并将它还原为已保存的状态。在执行重建之前，您应该已经创建、格式化和装载（mount）了该文件系统。不应该对包含文件的文件系统执行重建。

在需要的时候，可以重复这个过程来添加增量备份。

[root@node /]# restore -rf /dev/nst0

[root@node /]# restore -rf /backup/boot.dump /boot

列出 (-t)

dump 能够列出（ -t ）归档文件的内容

[root@node ~]#  restore -rt /dev/nst0

提取 (-x)

如果需要使用单独的文件而不是使用整个文件系统，您必须使用 -x 开关来提取它们。例如，要仅从我们的磁带备份中提取 /etc 目录，可使用以下命令：

[root@node ~]#  restore -xf /dev/nst0 /etc

交互式还原 (-i)

restore 提供的另外一个特性是交互式模式。使用命令：

[root@node ~]#  restore -if /dev/nst0

3.dump 和 restore

dump 和 restore 都能在网络上运行，因此您可以通过远程设备进行备份或还原。 dump 和 restore 使用磁带驱动器和提供广泛选项的文件设备。然而，两者都仅限用于 ext2 和 ext3 文件系统。如果使用的是 JFS、Reiser 或者其他文件系统，您将需要其他的实用工具，比如 tar 。