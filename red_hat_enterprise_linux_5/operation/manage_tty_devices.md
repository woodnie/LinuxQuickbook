### manage tty devices {#manage-tty-devices}

tty

要在虚拟控制台之前切换，使用Ctrl-Alt-F[1-6]

访问图形化控制台，使用Ctrl-Alt-F7

在Linux中，TTY也许是跟终端有关系的最为混乱的术语。TTY是TeleType的一个老缩写。Teletypes，或者teletypewriters，原来指的是电传打字机，是通过串行线用打印机键盘通过阅读和发送信息的东西，和古老的电报机区别并不是很大。之后，当计算机只能以批处理方式运行时(当时穿孔卡片阅读器是唯一一种使程序载入运行的方式)，电传打字机成为唯一能够被使用的&quot;实时&quot;输入/输出设备。最终，电传打字机被键盘和显示器终端所取代，但在终端或TTY接插的地方，操作系统仍然需要一个程序来监视串行端口。一个getty&quot;Get TTY&quot;的处理过程是:一个程序监视物理的TTY/终端接口。对一个虚拟网络服务器(VNC)来说，一个伪装的TTY(Pseudo-TTY，即家猫的TTY，也叫做&quot;PTY&quot;)是等价的终端。当你运行一个xterm(终端仿真程序)或GNOME终端程序时，PTY对虚拟的用户或者如xterm一样的伪终端来说，就像是一个TTY在运行。&quot;Pseudo&quot;的意思是&quot;duplicating in a fake way&quot;(用伪造的方法复制)，它相比&quot;virtual&quot;或&quot;emulated&quot;更能真实的说明问题。而在现在的计算中，它却处于被放弃的阶段。

tty是Teletype的缩写

   终端是一种字符型设备，它有多种类型，通常使用tty来简称各种类型的终端设备。tty是Teletype的缩写。Teletype是最早出现的一种终端设备，很象电传打字机（或者说就是），是由Teletype公司生产的。设备名放在特殊文件目录/dev/下，终端特殊设备文件一般有以下几种：

1.串行端口终端（/dev/ttySn）

   串行端口终端（Serial Port Terminal）是使用计算机串行端口连接的终端设备。计算机把每个串行端口都看作是一个字符设备。有段时间这些串行端口设备通常被称为终端设备，因为那时它的最大用途就是用来连接终端。这些串行端口所对应的设备名称是/dev/tts/0（或/dev/ttyS0）、/dev/tts/1（或/dev /ttyS1）等，设备号分别是（4,0）、（4,1）等，分别对应于DOS系统下的COM1、COM2等。若要向一个端口发送数据，可以在命令行上把标准输出重定向到这些特殊文件名上即可。例如，在命令行提示符下键入：echo test &gt; /dev/ttyS1会把单词&quot;test&quot;发送到连接在ttyS1（COM2）端口的设备上。

  当然，这不是固定的。标识设备最为重要的是主设备号和次设备号组成的二元组，然后是基于此的设备驱动程序。EP9301的这块开发板采用了/dev /ttyAM0来代替/dev/ttyS0，/dev/ttyAM1来代替/dev/ttyS1。我还没有学习开发驱动程序，下个学期要熟悉一下，以加深理解。

2.伪终端（/dev/pty/）

   伪终端（Pseudo Terminal）是成对的逻辑终端设备，例如/dev/ptyp3和/dev/ttyp3（或着在设备文件系统中分别是/dev/pty/m3和 /dev/pty/s3）。它们与实际物理设备并不直接相关。如果一个程序把ttyp3看作是一个串行端口设备，则它对该端口的读/写操作会反映在该逻辑终端设备对的另一个上面（ttyp3）。而ttyp3则是另一个程序用于读写操作的逻辑设备。这样，两个程序就可以通过这种逻辑设备进行互相交流，而其中一个使用ttyp3的程序则认为自己正在与一个串行端口进行通信。这很象是逻辑设备对之间的管道操作。

   对于ttyp3（s3），任何设计成使用一个串行端口设备的程序都可以使用该逻辑设备。但对于使用ptyp3的程序，则需要专门设计来使用 ptyp3（m3）逻辑设备。例如，如果某人在网上使用telnet程序连接到你的计算机上，则telnet程序就可能会开始连接到设备 ptyp2（m2）上（一个伪终端端口上）。此时一个getty程序就应该运行在对应的ttyp2（s2）端口上。当telnet从远端获取了一个字符时，该字符就会通过m2、s2传递给getty程序，而getty程序就会通过s2、m2和telnet程序往网络上返回&quot;login:&quot;字符串信息。这样，登录程序与telnet程序就通过&quot;伪终端&quot;进行通信。通过使用适当的软件，就可以把两个甚至多个伪终端设备连接到同一个物理串行端口上。

   在使用设备文件系统（device filesystem）之前，为了得到大量的伪终端设备特殊文件，HP-UX、AIX等使用了比较复杂的文件名命名方式。

   关于伪终端的编程也是很复杂的一块，要掌握不是一朝一夕就能办到的。先大体了解一下就是了。

3.控制终端（/dev/tty）

   如果当前进程有控制终端（Controlling Terminal）的话，那么/dev/tty就是当前进程的控制终端的设备特殊文件。可以使用命令&quot;ps -ax&quot;来查看进程与哪个控制终端相连。对于你登录的shell，/dev/tty就是你使用的终端，设备号是（5,0）。使用命令&quot;tty&quot;可以查看它具体对应哪个实际终端设备。/dev/tty有些类似于到实际所使用终端设备的一个联接。

4.控制台终端（/dev/ttyn, /dev/console）

   在UNIX系统中，计算机显示器通常被称为控制台终端（Console）。它仿真了类型为Linux的一种终端（TERM=Linux），并且有一些设备特殊文件与之相关联：tty0、tty1、tty2等。当你在控制台上登录时，使用的是tty1。使用Alt+[F1-F6]组合键时，我们就可以切换到 tty2、tty3等上面去。tty1 -tty6等称为虚拟终端，而tty0则是当前所使用虚拟终端的一个别名，系统所产生的信息会发送到该终端上。因此不管当前正在使用哪个虚拟终端，系统信息都会发送到控制台终端上。

   你可以登录到不同的虚拟终端上去，因而可以让系统同时有几个不同的会话期存在。只有系统或超级用户root可以向/dev/tty0进行写操作。

5.其它类型

   还针对很多不同的字符设备存在有很多其它种类的终端设备特殊文件。例如针对ISDN设备的/dev/ttyIn终端设备等。这里不再赘述。

       在UNIX系统中，计算机显示器通常被称为控制台终端(Console)。它仿真了类型为Linux的一种终端(TERM=Linux)，并且有一些设备特殊文件与之相关联：tty0、tty1、tty2等。当用户在控制台上登录时，使用的是tty1。使用Alt+[F1-F6]组合键时，我们就可以切换到tty2、tty3等上面去。tty1-tty6等称为虚拟终端，而tty0则是当前所使用虚拟终端的一个别名，系统所产生的信息会发送到该终端上。因此不管当前正在使用哪个虚拟终端，系统信息都会发送到控制台终端上。用户可以登录到不同的虚拟终端上去，因而可以让系统同时有几个不同的会话期存在。只有系统或超级用户root可以向/dev/tty0进行写操作。

       在Linux 中，可以在系统启动命令行里指定当前的输出终端，格式如下：  console=device, options

       device指代的是终端设备，可以是tty0(前台的虚拟终端)、ttyX(第X个虚拟终端)、ttySX(第X个串口)、lp0(第一个并口)等。options指代对device进行的设置，它取决于具体的设备驱动。对于串口设备，参数用来定义为：波特率、校验位、位数，格式为BBBBPN，其中BBBB表示波特率，P表示校验(n/o/e)，N表示位数，默认options是9600n8。用户可以在内核命令行中同时设定多个终端，这样输出将会在所有的终端上显示，而当用户调用open()打开/dev/console时，最后一个终端将会返回作为当前值。例如： console=ttyS1, 9600 console=tty0 .定义了2个终端，而调用open()打开/dev/console时，将使用虚拟终端tty0。但是内核消息会在tty0 VGA虚拟终端和串口ttyS1上同时显示。 通过查看/proc/tty/drivers文件可以获知什么类型的tty设备存在以及什么驱动被加载到内核，这个文件包括一个当前存在的不同 tty 驱动的列表，包括驱动名、缺省的节点名、驱动的主编号、这个驱动使用的次编号范围，以及 tty 驱动的类型。