### traceroute {#traceroute}

[root@www ~]# traceroute [ 選項與參數] IP

選項與參數：

-n ：可以不必進行主機的名稱解析，單純用 IP ，速度較快！

-U ：使用 UDP 的 port 33434 來進行偵測，這是預設的偵測協定；

-I ：使用 ICMP 的方式來進行偵測；

-T ：使用 TCP 來進行偵測，一般使用 port 80 測試

-w ：若對方主機在幾秒鐘內沒有回聲就宣告不治...預設是 5 秒

-p 埠號：若不想使用 UDP 與 TCP 的預設埠號來偵測，可在此改變埠號。

-i 裝置：用在比較複雜的環境，如果你的網路介面很多很複雜時，才會用到這個參數；

        舉例來說，你有兩條 ADSL 可以連接到外部，那你的主機會有兩個 ppp，

        你可以使用 -i 來選擇是 ppp0 還是 ppp1 啦！

-g 路由：與 -i 的參數相仿，只是 -g 後面接的是 gateway 的 IP 就是了。

# 範例一：偵測本機到 yahoo 去的各節點連線狀態

[root@www ~]# traceroute -n tw.yahoo.com

traceroute to tw.yahoo.com (119.160.246.241), 30 hops max, 40 byte packets

1  192.168.1.254  0.279 ms  0.156 ms  0.169 ms

2  172.20.168.254  0.430 ms  0.513 ms  0.409 ms

3  10.40.1.1  0.996 ms  0.890 ms  1.042 ms

4  203.72.191.85  0.942 ms  0.969 ms  0.951 ms

5  211.20.206.58  1.360 ms  1.379 ms  1.355 ms

6  203.75.72.90  1.123 ms  0.988 ms  1.086 ms

7  220.128.24.22  11.238 ms  11.179 ms  11.128 ms

8  220.128.1.82  12.456 ms  12.327 ms  12.221 ms

9  220.128.3.149  8.062 ms  8.058 ms  7.990 ms

10  * * *

11  119.160.240.1  10.688 ms  10.590 ms 119.160.240.3  10.047 ms

12  * * * &lt;==可能有防火牆裝置等情況發生所致

這個 traceroute 挺有意思的，這個指令會針對欲連接的目的地之所有 node 進行 UDP 的逾時等待， 例如上面的例子當中，由鳥哥的主機連接到 Yahoo 時，他會經過 12 個節點以上，traceroute 會主動的對這 12 個節點做 UDP 的回聲等待，並偵測回覆的時間，每節點偵測三次，最終回傳像上頭顯示的結果。 你可以發現每個節點其實回覆的時間大約在 50 ms 以內，算是還可以的 Internet 環境了。

比較特殊的算是第 10/12 個，會回傳星號的，代表該 node 可能設有某些防護措施，讓我們發送的封包資訊被丟棄所致。 因為我們是直接透過路由器轉遞封包，並沒有進入路由器去取得路由器的使用資源，所以某些路由器僅支援封包轉遞， 並不會接受來自用戶端的各項偵測啦！此時就會出現上述的問題。因為 traceroute 預設使用 UDP 封包，如果你想嘗試使用其他封包， 那麼 -I 或 -T 可以試看看囉！

由於目前 UDP/ICMP 的攻擊層出不窮，因此很多路由器可能就此取消這兩個封包的回應功能。所以我們可以使用 TCP 來偵測呦！ 例如使用同樣的方法，透過等待時間 1 秒，以及 TCP 80 埠口的情況下，可以這樣做：

[root@www ~]# traceroute -w 1 -n -T tw.yahoo.com